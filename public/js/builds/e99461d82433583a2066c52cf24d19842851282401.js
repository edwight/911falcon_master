function addPage(t,e,a){var i=(e.turn("pages"),$("<div />",{}));e.turn("addPage",i,t)&&(i.html('<div class="gradient"></div><div class="loader"></div>'),loadPage(t,i,a))}function loadPage(t,e,a){var i=$("<img />");i.mousedown(function(t){t.preventDefault()}),i.load(function(){$(this).css({width:"100%",height:"100%"}),$(this).appendTo(e),e.find(".loader").remove()}),i.attr("src",a+"/"+t+".jpg"),loadRegions(t,e,a)}function loadRegions(t,e,a){$.getJSON(a+"/"+t+"-regions.json").done(function(t){$.each(t,function(t,a){addRegion(a,e)})})}function addRegion(t,e){var a=$("<div />",{"class":"region  "+t["class"]}),i=$(".magazine").turn("options"),o=i.width/2,n=i.height;a.css({top:Math.round(t.y/n*100)+"%",left:Math.round(t.x/o*100)+"%",width:Math.round(t.width/o*100)+"%",height:Math.round(t.height/n*100)+"%"}).attr("region-data",$.param(t.data||"")),a.appendTo(e)}function regionClick(t){var e=$(t.target);if(e.hasClass("region")){var a=$.trim(e.attr("class").replace("region",""));return processRegion(e,a)}}function processRegion(t,e){switch(data=decodeParams(t.attr("region-data")),e){case"link":window.open(data.url);break;case"zoom":var a=t.offset(),i=$(".magazine-viewport").offset(),o={x:a.left-i.left,y:a.top-i.top};$(".magazine-viewport").zoom("zoomIn",o);break;case"to-page":$(".magazine").turn("page",data.page)}}function loadLargePage(t,e,a){var i=$("<img />");i.load(function(){var t=e.find("img");$(this).css({width:"100%",height:"100%"}),$(this).appendTo(e),t.remove()}),i.attr("src",a+"/"+t+"-large.jpg")}function loadSmallPage(t,e,a){var i=e.find("img");i.css({width:"100%",height:"100%"}),i.unbind("load"),i.attr("src",a+"/"+t+".jpg")}function isChrome(){return-1!=navigator.userAgent.indexOf("Chrome")}function disableControls(t){1==t?$(".previous-button").hide():$(".previous-button").show(),t==$(".magazine").turn("pages")?$(".next-button").hide():$(".next-button").show()}function resizeViewport(){var t=$(window).width(),e=$(window).height(),a=$(".magazine").turn("options");if($(".magazine").removeClass("animated"),$(".magazine-viewport").css({width:t,height:e}).zoom("resize"),1==$(".magazine").turn("zoom")){var i=calculateBound({width:a.width,height:a.height,boundWidth:Math.min(a.width,t),boundHeight:Math.min(a.height,e)});i.width%2!==0&&(i.width-=1),(i.width!=$(".magazine").width()||i.height!=$(".magazine").height())&&($(".magazine").turn("size",i.width,i.height),1==$(".magazine").turn("page")&&$(".magazine").turn("peel","br"),$(".next-button").css({height:i.height,backgroundPosition:"-38px "+(i.height/2-16)+"px"}),$(".previous-button").css({height:i.height,backgroundPosition:"-4px "+(i.height/2-16)+"px"})),$(".magazine").css({top:-i.height/2,left:-i.width/2})}var o=$(".magazine").offset(),n=e-o.top-$(".magazine").height(),s=(n-$(".thumbnails > div").height())/2;0>s?$(".thumbnails").css({height:1}):($(".thumbnails").css({height:n}),$(".thumbnails > div").css({marginTop:s})),o.top<$(".made").height()?$(".made").hide():$(".made").show(),$(".magazine").addClass("animated")}function largeMagazineWidth(){return 2214}function decodeParams(t){for(var e,a=t.split("&"),i={},o=0;o<a.length;o++)e=a[o].split("="),i[decodeURIComponent(e[0])]=decodeURIComponent(e[1]);return i}function calculateBound(t){var e={width:t.width,height:t.height};if(e.width>t.boundWidth||e.height>t.boundHeight){var a=e.width/e.height;t.boundWidth/a>t.boundHeight&&t.boundHeight*a<=t.boundWidth?(e.width=Math.round(t.boundHeight*a),e.height=t.boundHeight):(e.width=t.boundWidth,e.height=Math.round(t.boundWidth/a))}return e}!function(){"use strict";var t={},e=100,a=0,i=!1,o=null,n=null,s=function(t){return Object.freeze?Object.freeze(t):t},r=function(){return window.location.href.split("#")},h=function(){o||(o=setInterval(function(){a>0&&n!=window.location.href&&(n=window.location.href,window.Hash.check())},e))};window.Hash=s({pushState:function(t){return window.history&&window.history.pushState&&(i=t),this},fragment:function(){var t=r();return i?window.location.pathname+(t[1]?"#"+t[1]:""):t[1]||""},get:function(t,e){var a,o=[];for(a in e)Object.prototype.hasOwnProperty(a)&&o.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));return o.length>0&&(o="?"+o.join("&")),i?t+o:r()[0]+"#"+t+o},go:function(t,e){if(this.fragment()!=t){var a=this.get(t,e);i?window.history.pushState(null,document.title,a):window.location.href=a}return this},update:function(){return n=window.location.href,this},on:function(e,i,o){return t[e]||(t[e]={title:o,listeners:[]}),t[e].listeners.push(i),a++,h(),this},check:function(){var e,a,i,o=this.fragment();for(a in t)if(Object.prototype.hasOwnProperty.call(t,a))if(t[a].regexp=t[a].regexp||new RegExp(a),i=t[a].regexp.exec(o))for(t[a].title&&(document.title=t[a].title),e=0;e<t[a].listeners.length;e++)t[a].listeners[e].yep&&t[a].listeners[e].yep(o,i);else for(e=0;e<t[a].listeners.length;e++)t[a].listeners[e].nop&&t[a].listeners[e].nop(o);return this}})}(),function(t){function e(t,e,a){if(!a[0]||"object"==typeof a[0])return e.init.apply(t,a);if(e[a[0]])return e[a[0]].apply(t,Array.prototype.slice.call(a,1));throw l(a[0]+" is not a method or property")}function a(t,e,a,i){return{css:{position:"absolute",top:t,left:e,overflow:i||"hidden",zIndex:a||"auto"}}}function i(t,e,a,i,n){var s=1-n,r=s*s*s,h=n*n*n;return o(Math.round(r*t.x+3*n*s*s*e.x+3*n*n*s*a.x+h*i.x),Math.round(r*t.y+3*n*s*s*e.y+3*n*n*s*a.y+h*i.y))}function o(t,e){return{x:t,y:e}}function n(t,e,a){return g&&a?" translate3d("+t+"px,"+e+"px, 0px) ":" translate("+t+"px, "+e+"px) "}function s(t){return" rotate("+t+"deg) "}function r(t,e){return Object.prototype.hasOwnProperty.call(e,t)}function h(){for(var t=["Moz","Webkit","Khtml","O","ms"],e=t.length,a="";e--;)t[e]+"Transform"in document.body.style&&(a="-"+t[e].toLowerCase()+"-");return a}function d(t,e,a,i,n){var s,r=[];if("-webkit-"==f){for(s=0;n>s;s++)r.push("color-stop("+i[s][0]+", "+i[s][1]+")");t.css({"background-image":"-webkit-gradient(linear, "+e.x+"% "+e.y+"%,"+a.x+"% "+a.y+"%, "+r.join(",")+" )"})}else{var e={x:e.x/100*t.width(),y:e.y/100*t.height()},a={x:a.x/100*t.width(),y:a.y/100*t.height()},h=a.x-e.x;s=a.y-e.y;var d=Math.atan2(s,h),p=d-Math.PI/2,p=Math.abs(t.width()*Math.sin(p))+Math.abs(t.height()*Math.cos(p)),h=Math.sqrt(s*s+h*h),a=o(a.x<e.x?t.width():0,a.y<e.y?t.height():0),l=Math.tan(d);for(s=-1/l,l=(s*a.x-a.y-l*e.x+e.y)/(s-l),a=s*l-s*a.x+a.y,e=Math.sqrt(Math.pow(l-e.x,2)+Math.pow(a-e.y,2)),s=0;n>s;s++)r.push(" "+i[s][1]+" "+100*(e+h*i[s][0])/p+"%");t.css({"background-image":f+"linear-gradient("+-d+"rad,"+r.join(",")+")"})}}function p(e,a,i){return e=t.Event(e),a.trigger(e,i),e.isDefaultPrevented()?"prevented":e.isPropagationStopped()?"stopped":""}function l(t){function e(t){this.name="TurnJsError",this.message=t}return e.prototype=Error(),e.prototype.constructor=e,new e(t)}function u(t){var e={top:0,left:0};do e.left+=t.offsetLeft,e.top+=t.offsetTop;while(t=t.offsetParent);return e}var g,c,f="",v=Math.PI,m=v/2,w="ontouchstart"in window,x=w?{down:"touchstart",move:"touchmove",up:"touchend",over:"touchstart",out:"touchend"}:{down:"mousedown",move:"mousemove",up:"mouseup",over:"mouseover",out:"mouseout"},b={backward:["bl","tl"],forward:["br","tr"],all:"tl bl tr br l r".split(" ")},y=["single","double"],z=["ltr","rtl"],P={acceleration:!0,display:"double",duration:600,page:1,gradients:!0,turnCorners:"bl,br",when:null},_={cornerSize:100},M={init:function(e){g="WebKitCSSMatrix"in window||"MozPerspective"in document.body.style;var a;c=(a=/AppleWebkit\/([0-9\.]+)/i.exec(navigator.userAgent))?534.3<parseFloat(a[1]):!0,f=h();var i;a=0;var o=this.data(),s=this.children(),e=t.extend({width:this.width(),height:this.height(),direction:this.attr("dir")||this.css("direction")||"ltr"},P,e);if(o.opts=e,o.pageObjs={},o.pages={},o.pageWrap={},o.pageZoom={},o.pagePlace={},o.pageMv=[],o.zoom=1,o.totalPages=e.pages||0,o.eventHandlers={touchStart:t.proxy(M._touchStart,this),touchMove:t.proxy(M._touchMove,this),touchEnd:t.proxy(M._touchEnd,this),start:t.proxy(M._eventStart,this)},e.when)for(i in e.when)r(i,e.when)&&this.bind(i,e.when[i]);for(this.css({position:"relative",width:e.width,height:e.height}),this.turn("display",e.display),""!==e.direction&&this.turn("direction",e.direction),g&&!w&&e.acceleration&&this.transform(n(0,0,!0)),i=0;i<s.length;i++)"1"!=t(s[i]).attr("ignore")&&this.turn("addPage",s[i],++a);return t(this).bind(x.down,o.eventHandlers.touchStart).bind("end",M._eventEnd).bind("pressed",M._eventPressed).bind("released",M._eventReleased).bind("flip",M._flip),t(this).parent().bind("start",o.eventHandlers.start),t(document).bind(x.move,o.eventHandlers.touchMove).bind(x.up,o.eventHandlers.touchEnd),this.turn("page",e.page),o.done=!0,this},addPage:function(e,a){var i,o=!1,n=this.data(),s=n.totalPages+1;if(n.destroying)return!1;if((i=/\bp([0-9]+)\b/.exec(t(e).attr("class")))&&(a=parseInt(i[1],10)),a){if(a==s)o=!0;else if(a>s)throw l('Page "'+a+'" cannot be inserted')}else a=s,o=!0;return a>=1&&s>=a&&(i="double"==n.display?a%2?" odd":" even":"",n.done&&this.turn("stop"),a in n.pageObjs&&M._movePages.call(this,a,1),o&&(n.totalPages=s),n.pageObjs[a]=t(e).css({"float":"left"}).addClass("page p"+a+i),-1!=navigator.userAgent.indexOf("MSIE 9.0")&&n.pageObjs[a].hasClass("hard")&&n.pageObjs[a].removeClass("hard"),M._addPage.call(this,a),M._removeFromDOM.call(this)),this},_addPage:function(e){var a=this.data(),i=a.pageObjs[e];if(i)if(M._necessPage.call(this,e)){if(!a.pageWrap[e]){a.pageWrap[e]=t("<div/>",{"class":"page-wrapper",page:e,css:{position:"absolute",overflow:"hidden"}}),this.append(a.pageWrap[e]),a.pagePlace[e]||(a.pagePlace[e]=e,a.pageObjs[e].appendTo(a.pageWrap[e]));var o=M._pageSize.call(this,e,!0);i.css({width:o.width,height:o.height}),a.pageWrap[e].css(o)}a.pagePlace[e]==e&&M._makeFlip.call(this,e)}else a.pagePlace[e]=0,a.pageObjs[e]&&a.pageObjs[e].remove()},hasPage:function(t){return r(t,this.data().pageObjs)},center:function(e){var a=this.data(),i=t(this).turn("size"),o=0;return a.noCenter||("double"==a.display&&(e=this.turn("view",e||a.tpage||a.page),"ltr"==a.direction?e[0]?e[1]||(o+=i.width/4):o-=i.width/4:e[0]?e[1]||(o-=i.width/4):o+=i.width/4),t(this).css({marginLeft:o})),this},destroy:function(){var e=this,a=this.data(),i="end first flip last pressed released start turning turned zooming missing".split(" ");if("prevented"!=p("destroying",this)){for(a.destroying=!0,t.each(i,function(t,a){e.unbind(a)}),this.parent().unbind("start",a.eventHandlers.start),t(document).unbind(x.move,a.eventHandlers.touchMove).unbind(x.up,a.eventHandlers.touchEnd);0!==a.totalPages;)this.turn("removePage",a.totalPages);return a.fparent&&a.fparent.remove(),a.shadow&&a.shadow.remove(),this.removeData(),a=null,this}},is:function(){return"object"==typeof this.data().pages},zoom:function(e){var a=this.data();if("number"==typeof e){if(.001>e||e>100)throw l(e+" is not a value for zoom");if("prevented"==p("zooming",this,[e,a.zoom]))return this;var i=this.turn("size"),o=this.turn("view"),n=1/a.zoom,s=Math.round(i.width*n*e),i=Math.round(i.height*n*e);for(a.zoom=e,t(this).turn("stop").turn("size",s,i),a.opts.autoCenter&&this.turn("center"),M._updateShadow.call(this),e=0;e<o.length;e++)o[e]&&a.pageZoom[o[e]]!=a.zoom&&(this.trigger("zoomed",[o[e],o,a.pageZoom[o[e]],a.zoom]),a.pageZoom[o[e]]=a.zoom);return this}return a.zoom},_pageSize:function(t,e){var a=this.data(),i={};if("single"==a.display)i.width=this.width(),i.height=this.height(),e&&(i.top=0,i.left=0,i.right="auto");else{var o=this.width()/2,n=this.height();if(a.pageObjs[t].hasClass("own-size")?(i.width=a.pageObjs[t].width(),i.height=a.pageObjs[t].height()):(i.width=o,i.height=n),e){var s=t%2;i.top=(n-i.height)/2,"ltr"==a.direction?(i[s?"right":"left"]=o-i.width,i[s?"left":"right"]="auto"):(i[s?"left":"right"]=o-i.width,i[s?"right":"left"]="auto")}}return i},_makeFlip:function(t){var e=this.data();if(!e.pages[t]&&e.pagePlace[t]==t){var a="single"==e.display,i=t%2;e.pages[t]=e.pageObjs[t].css(M._pageSize.call(this,t)).flip({page:t,next:i||a?t+1:t-1,turn:this}).flip("disable",e.disabled),M._setPageLoc.call(this,t),e.pageZoom[t]=e.zoom}return e.pages[t]},_makeRange:function(){var t,e;if(!(1>this.data().totalPages))for(e=this.turn("range"),t=e[0];t<=e[1];t++)M._addPage.call(this,t)},range:function(t){var e,a,i,o=this.data(),t=t||o.tpage||o.page||1;if(i=M._view.call(this,t),1>t||t>o.totalPages)throw l('"'+t+'" is not a valid page');return i[1]=i[1]||i[0],1<=i[0]&&i[1]<=o.totalPages?(t=Math.floor(2),o.totalPages-i[1]>i[0]?(e=Math.min(i[0]-1,t),a=2*t-e):(a=Math.min(o.totalPages-i[1],t),e=2*t-a)):a=e=5,[Math.max(1,i[0]-e),Math.min(o.totalPages,i[1]+a)]},_necessPage:function(t){if(0===t)return!0;var e=this.turn("range");return this.data().pageObjs[t].hasClass("fixed")||t>=e[0]&&t<=e[1]},_removeFromDOM:function(){var t,e=this.data();for(t in e.pageWrap)r(t,e.pageWrap)&&!M._necessPage.call(this,t)&&M._removePageFromDOM.call(this,t)},_removePageFromDOM:function(t){var e=this.data();if(e.pages[t]){var a=e.pages[t].data();T._moveFoldingPage.call(e.pages[t],!1),a.f&&a.f.fwrapper&&a.f.fwrapper.remove(),e.pages[t].removeData(),e.pages[t].remove(),delete e.pages[t]}e.pageObjs[t]&&e.pageObjs[t].remove(),e.pageWrap[t]&&(e.pageWrap[t].remove(),delete e.pageWrap[t]),M._removeMv.call(this,t),delete e.pagePlace[t],delete e.pageZoom[t]},removePage:function(t){var e=this.data();if("*"==t)for(;0!==e.totalPages;)this.turn("removePage",e.totalPages);else{if(1>t||t>e.totalPages)throw l("The page "+t+" doesn't exist");e.pageObjs[t]&&(this.turn("stop"),M._removePageFromDOM.call(this,t),delete e.pageObjs[t]),M._movePages.call(this,t,-1),e.totalPages-=1,e.page>e.totalPages?(e.page=null,M._fitPage.call(this,e.totalPages)):(M._makeRange.call(this),this.turn("update"))}return this},_movePages:function(t,e){var a,i=this,o=this.data(),n="single"==o.display,s=function(t){var a=t+e,s=a%2,r=s?" odd ":" even ";o.pageObjs[t]&&(o.pageObjs[a]=o.pageObjs[t].removeClass("p"+t+" odd even").addClass("p"+a+r)),o.pagePlace[t]&&o.pageWrap[t]&&(o.pagePlace[a]=a,o.pageWrap[a]=o.pageObjs[a].hasClass("fixed")?o.pageWrap[t].attr("page",a):o.pageWrap[t].css(M._pageSize.call(i,a,!0)).attr("page",a),o.pages[t]&&(o.pages[a]=o.pages[t].flip("options",{page:a,next:n||s?a+1:a-1})),e&&(delete o.pages[t],delete o.pagePlace[t],delete o.pageZoom[t],delete o.pageObjs[t],delete o.pageWrap[t]))};if(e>0)for(a=o.totalPages;a>=t;a--)s(a);else for(a=t;a<=o.totalPages;a++)s(a)},display:function(e){var a=this.data(),i=a.display;if(void 0===e)return i;if(-1==t.inArray(e,y))throw l('"'+e+'" is not a value for display');switch(e){case"single":a.pageObjs[0]||(this.turn("stop").css({overflow:"hidden"}),a.pageObjs[0]=t("<div />",{"class":"page p-temporal"}).css({width:this.width(),height:this.height()}).appendTo(this)),this.addClass("shadow");break;case"double":a.pageObjs[0]&&(this.turn("stop").css({overflow:""}),a.pageObjs[0].remove(),delete a.pageObjs[0]),this.removeClass("shadow")}return a.display=e,i&&(e=this.turn("size"),M._movePages.call(this,1,0),this.turn("size",e.width,e.height).turn("update")),this},direction:function(e){var a=this.data();if(void 0===e)return a.direction;if(e=e.toLowerCase(),-1==t.inArray(e,z))throw l('"'+e+'" is not a value for direction');return"rtl"==e&&t(this).attr("dir","ltr").css({direction:"ltr"}),a.direction=e,a.done&&this.turn("size",t(this).width(),t(this).height()),this},animating:function(){return 0<this.data().pageMv.length},corner:function(){var t,e,a=this.data();for(e in a.pages)if(r(e,a.pages)&&(t=a.pages[e].flip("corner")))return t;return!1},data:function(){return this.data()},disable:function(e){var a,i=this.data(),o=this.turn("view");i.disabled=void 0===e||!0===e;for(a in i.pages)r(a,i.pages)&&i.pages[a].flip("disable",i.disabled?!0:-1==t.inArray(parseInt(a,10),o));return this},disabled:function(t){return void 0===t?!0===this.data().disabled:this.turn("disable",t)},size:function(t,e){if(void 0===t||void 0===e)return{width:this.width(),height:this.height()};this.turn("stop");var a,i,o=this.data();i="double"==o.display?t/2:t,this.css({width:t,height:e}),o.pageObjs[0]&&o.pageObjs[0].css({width:i,height:e});for(a in o.pageWrap)r(a,o.pageWrap)&&(i=M._pageSize.call(this,a,!0),o.pageObjs[a].css({width:i.width,height:i.height}),o.pageWrap[a].css(i),o.pages[a]&&o.pages[a].css({width:i.width,height:i.height}));return this.turn("resize"),this},resize:function(){var t,e=this.data();for(e.pages[0]&&(e.pageWrap[0].css({left:-this.width()}),e.pages[0].flip("resize",!0)),t=1;t<=e.totalPages;t++)e.pages[t]&&e.pages[t].flip("resize",!0);M._updateShadow.call(this),e.opts.autoCenter&&this.turn("center")},_removeMv:function(t){var e,a=this.data();for(e=0;e<a.pageMv.length;e++)if(a.pageMv[e]==t)return a.pageMv.splice(e,1),!0;return!1},_addMv:function(t){var e=this.data();M._removeMv.call(this,t),e.pageMv.push(t)},_view:function(t){var e=this.data(),t=t||e.page;return"double"==e.display?t%2?[t-1,t]:[t,t+1]:[t]},view:function(t){var e=this.data(),t=M._view.call(this,t);return"double"==e.display?[0<t[0]?t[0]:0,t[1]<=e.totalPages?t[1]:0]:[0<t[0]&&t[0]<=e.totalPages?t[0]:0]},stop:function(t,e){if(this.turn("animating")){var a,i,o,n=this.data();for(n.tpage&&(n.page=n.tpage,delete n.tpage),a=0;a<n.pageMv.length;a++)n.pageMv[a]&&n.pageMv[a]!==t&&(o=n.pages[n.pageMv[a]],i=o.data().f.opts,o.flip("hideFoldedPage",e),e||T._moveFoldingPage.call(o,!1),i.force&&(i.next=0===i.page%2?i.page-1:i.page+1,delete i.force))}return this.turn("update"),this},pages:function(t){var e=this.data();if(t){if(t<e.totalPages)for(var a=e.totalPages;a>t;a--)this.turn("removePage",a);return e.totalPages=t,M._fitPage.call(this,e.page),this}return e.totalPages},_missing:function(t){var e=this.data();if(!(1>e.totalPages)){for(var a=this.turn("range",t),i=[],t=a[0];t<=a[1];t++)e.pageObjs[t]||i.push(t);0<i.length&&this.trigger("missing",[i])}},_fitPage:function(t){var e=this.data(),a=this.turn("view",t);if(M._missing.call(this,t),e.pageObjs[t]){e.page=t,this.turn("stop");for(var i=0;i<a.length;i++)a[i]&&e.pageZoom[a[i]]!=e.zoom&&(this.trigger("zoomed",[a[i],a,e.pageZoom[a[i]],e.zoom]),e.pageZoom[a[i]]=e.zoom);M._removeFromDOM.call(this),M._makeRange.call(this),M._updateShadow.call(this),this.trigger("turned",[t,a]),this.turn("update"),e.opts.autoCenter&&this.turn("center")}},_turnPage:function(e){var a,i,o=this.data(),n=o.pagePlace[e],s=this.turn("view"),r=this.turn("view",e);if(o.page!=e){var h=o.page;if("prevented"==p("turning",this,[e,r]))return void(h==o.page&&-1!=t.inArray(n,o.pageMv)&&o.pages[n].flip("hideFoldedPage",!0));-1!=t.inArray(1,r)&&this.trigger("first"),-1!=t.inArray(o.totalPages,r)&&this.trigger("last")}"single"==o.display?(a=s[0],i=r[0]):s[1]&&e>s[1]?(a=s[1],i=r[0]):s[0]&&e<s[0]&&(a=s[0],i=r[1]),n=o.opts.turnCorners.split(","),s=o.pages[a].data().f,r=s.opts,h=s.point,M._missing.call(this,e),o.pageObjs[e]&&(this.turn("stop"),o.page=e,M._makeRange.call(this),o.tpage=i,r.next!=i&&(r.next=i,r.force=!0),this.turn("update"),s.point=h,"hard"==s.effect?"ltr"==o.direction?o.pages[a].flip("turnPage",e>a?"r":"l"):o.pages[a].flip("turnPage",e>a?"l":"r"):"ltr"==o.direction?o.pages[a].flip("turnPage",n[e>a?1:0]):o.pages[a].flip("turnPage",n[e>a?0:1]))},page:function(e){var a=this.data();if(void 0===e)return a.page;if(!a.disabled&&!a.destroying){if(e=parseInt(e,10),e>0&&e<=a.totalPages)return e!=a.page&&(a.done&&-1==t.inArray(e,this.turn("view"))?M._turnPage.call(this,e):M._fitPage.call(this,e)),this;throw l("The page "+e+" does not exist")}},next:function(){return this.turn("page",Math.min(this.data().totalPages,M._view.call(this,this.data().page).pop()+1))},previous:function(){return this.turn("page",Math.max(1,M._view.call(this,this.data().page).shift()-1))},peel:function(t,e){var a=this.data(),i=this.turn("view"),e=void 0===e?!0:!0===e;return!1===t?this.turn("stop",null,e):"single"==a.display?a.pages[a.page].flip("peel",t,e):(i="ltr"==a.direction?-1!=t.indexOf("l")?i[0]:i[1]:-1!=t.indexOf("l")?i[1]:i[0],a.pages[i]&&a.pages[i].flip("peel",t,e)),this},_addMotionPage:function(){var e=t(this).data().f.opts,a=e.turn;a.data(),M._addMv.call(a,e.page)},_eventStart:function(t,e,a){var i=e.turn.data(),o=i.pageZoom[e.page];t.isDefaultPrevented()||(o&&o!=i.zoom&&(e.turn.trigger("zoomed",[e.page,e.turn.turn("view",e.page),o,i.zoom]),i.pageZoom[e.page]=i.zoom),"single"==i.display&&a&&("l"==a.charAt(1)&&"ltr"==i.direction||"r"==a.charAt(1)&&"rtl"==i.direction?(e.next=e.next<e.page?e.next:e.page-1,e.force=!0):e.next=e.next>e.page?e.next:e.page+1),M._addMotionPage.call(t.target)),M._updateShadow.call(e.turn)},_eventEnd:function(e,a,i){t(e.target).data();var e=a.turn,o=e.data();i?(i=o.tpage||o.page,(i==a.next||i==a.page)&&(delete o.tpage,M._fitPage.call(e,i||a.next,!0))):(M._removeMv.call(e,a.page),M._updateShadow.call(e),e.turn("update"))},_eventPressed:function(e){var e=t(e.target).data().f,a=e.opts.turn;return a.data().mouseAction=!0,a.turn("update"),e.time=(new Date).getTime()},_eventReleased:function(e,a){var i;i=t(e.target);var o=i.data().f,n=o.opts.turn,s=n.data();i="single"==s.display?"br"==a.corner||"tr"==a.corner?a.x<i.width()/2:a.x>i.width()/2:0>a.x||a.x>i.width(),(200>(new Date).getTime()-o.time||i)&&(e.preventDefault(),M._turnPage.call(n,o.opts.next)),s.mouseAction=!1},_flip:function(e){e.stopPropagation(),e=t(e.target).data().f.opts,e.turn.trigger("turn",[e.next]),e.turn.data().opts.autoCenter&&e.turn.turn("center",e.next)},_touchStart:function(){var t,e=this.data();for(t in e.pages)if(r(t,e.pages)&&!1===T._eventStart.apply(e.pages[t],arguments))return!1},_touchMove:function(){var t,e=this.data();for(t in e.pages)r(t,e.pages)&&T._eventMove.apply(e.pages[t],arguments)},_touchEnd:function(){var t,e=this.data();for(t in e.pages)r(t,e.pages)&&T._eventEnd.apply(e.pages[t],arguments)},calculateZ:function(t){var e,a,i,o,n=this,s=this.data();e=this.turn("view");var r=e[0]||e[1],h=t.length-1,d={pageZ:{},partZ:{},pageV:{}},p=function(t){t=n.turn("view",t),t[0]&&(d.pageV[t[0]]=!0),t[1]&&(d.pageV[t[1]]=!0)};for(e=0;h>=e;e++)a=t[e],i=s.pages[a].data().f.opts.next,o=s.pagePlace[a],p(a),p(i),a=s.pagePlace[i]==i?i:a,d.pageZ[a]=s.totalPages-Math.abs(r-a),d.partZ[o]=2*s.totalPages-h+e;return d},update:function(){var e,a=this.data();if(this.turn("animating")&&0!==a.pageMv[0]){var i,o=this.turn("calculateZ",a.pageMv),n=this.turn("corner"),s=this.turn("view"),h=this.turn("view",a.tpage);for(e in a.pageWrap)r(e,a.pageWrap)&&(i=a.pageObjs[e].hasClass("fixed"),a.pageWrap[e].css({display:o.pageV[e]||i?"":"none",zIndex:(a.pageObjs[e].hasClass("hard")?o.partZ[e]:o.pageZ[e])||(i?-1:0)}),i=a.pages[e])&&(i.flip("z",o.partZ[e]||null),o.pageV[e]&&i.flip("resize"),a.tpage?i.flip("hover",!1).flip("disable",-1==t.inArray(parseInt(e,10),a.pageMv)&&e!=h[0]&&e!=h[1]):i.flip("hover",!1===n).flip("disable",e!=s[0]&&e!=s[1]))}else for(e in a.pageWrap)r(e,a.pageWrap)&&(o=M._setPageLoc.call(this,e),a.pages[e]&&a.pages[e].flip("disable",a.disabled||1!=o).flip("hover",!0).flip("z",null));return this},_updateShadow:function(){var e,i,o=this.data(),n=this.width(),s=this.height(),r="single"==o.display?n:n/2;e=this.turn("view"),o.shadow||(o.shadow=t("<div />",{"class":"shadow",css:a(0,0,0).css}).appendTo(this));for(var h=0;h<o.pageMv.length&&e[0]&&e[1];h++)e=this.turn("view",o.pages[o.pageMv[h]].data().f.opts.next),i=this.turn("view",o.pageMv[h]),e[0]=e[0]&&i[0],e[1]=e[1]&&i[1];switch(e[0]?e[1]?3:"ltr"==o.direction?2:1:"ltr"==o.direction?1:2){case 1:o.shadow.css({width:r,height:s,top:0,left:r});break;case 2:o.shadow.css({width:r,height:s,top:0,left:0});break;case 3:o.shadow.css({width:n,height:s,top:0,left:0})}},_setPageLoc:function(t){var e=this.data(),a=this.turn("view"),i=0;if(t==a[0]||t==a[1]?i=1:("single"==e.display&&t==a[0]+1||"double"==e.display&&t==a[0]-2||t==a[1]+2)&&(i=2),!this.turn("animating"))switch(i){case 1:e.pageWrap[t].css({zIndex:e.totalPages,display:""});break;case 2:e.pageWrap[t].css({zIndex:e.totalPages-1,display:""});break;case 0:e.pageWrap[t].css({zIndex:0,display:e.pageObjs[t].hasClass("fixed")?"":"none"})}return i},options:function(e){if(void 0===e)return this.data().opts;var a=this.data();if(t.extend(a.opts,e),e.pages&&this.turn("pages",e.pages),e.page&&this.turn("page",e.page),e.display&&this.turn("display",e.display),e.direction&&this.turn("direction",e.direction),e.width&&e.height&&this.turn("size",e.width,e.height),e.when)for(var i in e.when)r(i,e.when)&&this.unbind(i).bind(i,e.when[i]);return this},version:function(){return"4.1.0"}},T={init:function(t){return this.data({f:{disabled:!1,hover:!1,effect:this.hasClass("hard")?"hard":"sheet"}}),this.flip("options",t),T._addPageWrapper.call(this),this},setData:function(e){var a=this.data();return a.f=t.extend(a.f,e),this},options:function(e){var a=this.data().f;return e?(T.setData.call(this,{opts:t.extend({},a.opts||_,e)}),this):a.opts},z:function(t){var e=this.data().f;return e.opts["z-index"]=t,e.fwrapper&&e.fwrapper.css({zIndex:t||parseInt(e.parent.css("z-index"),10)||0}),this},_cAllowed:function(){var t=this.data().f,e=t.opts.page,a=t.opts.turn.data(),i=e%2;return"hard"==t.effect?"ltr"==a.direction?[i?"r":"l"]:[i?"l":"r"]:"single"==a.display?1==e?"ltr"==a.direction?b.forward:b.backward:e==a.totalPages?"ltr"==a.direction?b.backward:b.forward:b.all:"ltr"==a.direction?b[i?"forward":"backward"]:b[i?"backward":"forward"]},_cornerActivated:function(e){var a=this.data().f,i=this.width(),o=this.height(),e={x:e.x,y:e.y,corner:""},n=a.opts.cornerSize;if(0>=e.x||0>=e.y||e.x>=i||e.y>=o)return!1;var s=T._cAllowed.call(this);switch(a.effect){case"hard":if(e.x>i-n)e.corner="r";else{if(!(e.x<n))return!1;e.corner="l"}break;case"sheet":if(e.y<n)e.corner+="t";else{if(!(e.y>=o-n))return!1;e.corner+="b"}if(e.x<=n)e.corner+="l";else{if(!(e.x>=i-n))return!1;e.corner+="r"}}return e.corner&&-1!=t.inArray(e.corner,s)?e:!1},_isIArea:function(t){var e=this.data().f.parent.offset(),t=w&&t.originalEvent?t.originalEvent.touches[0]:t;return T._cornerActivated.call(this,{x:t.pageX-e.left,y:t.pageY-e.top})},_c:function(t,e){switch(e=e||0,t){case"tl":return o(e,e);case"tr":return o(this.width()-e,e);case"bl":return o(e,this.height()-e);case"br":return o(this.width()-e,this.height()-e);case"l":return o(e,0);case"r":return o(this.width()-e,0)}},_c2:function(t){switch(t){case"tl":return o(2*this.width(),0);case"tr":return o(-this.width(),0);case"bl":return o(2*this.width(),this.height());case"br":return o(-this.width(),this.height());case"l":return o(2*this.width(),0);case"r":return o(-this.width(),0)}},_foldingPage:function(){var t=this.data().f;if(t){var e=t.opts;if(e.turn)return t=e.turn.data(),"single"==t.display?1<e.next||1<e.page?t.pageObjs[0]:null:t.pageObjs[e.next]}},_backGradient:function(){var e=this.data().f,i=e.opts.turn.data();return(i=i.opts.gradients&&("single"==i.display||2!=e.opts.page&&e.opts.page!=i.totalPages-1))&&!e.bshadow&&(e.bshadow=t("<div/>",a(0,0,1)).css({position:"",width:this.width(),height:this.height()}).appendTo(e.parent)),i},type:function(){return this.data().f.effect},resize:function(t){var e=this.data().f,a=e.opts.turn.data(),i=this.width(),o=this.height();switch(e.effect){case"hard":t&&(e.wrapper.css({width:i,height:o}),e.fpage.css({width:i,height:o}),a.opts.gradients&&(e.ashadow.css({width:i,height:o}),e.bshadow.css({width:i,height:o})));break;case"sheet":t&&(t=Math.round(Math.sqrt(Math.pow(i,2)+Math.pow(o,2))),e.wrapper.css({width:t,height:t}),e.fwrapper.css({width:t,height:t}).children(":first-child").css({width:i,height:o}),e.fpage.css({width:i,height:o}),a.opts.gradients&&e.ashadow.css({width:i,height:o}),T._backGradient.call(this)&&e.bshadow.css({width:i,height:o})),e.parent.is(":visible")&&(a=u(e.parent[0]),e.fwrapper.css({top:a.top,left:a.left}),a=u(e.opts.turn[0]),e.fparent.css({top:-a.top,left:-a.left})),this.flip("z",e.opts["z-index"])}},_addPageWrapper:function(){var e=this.data().f,i=e.opts.turn.data(),o=this.parent();if(e.parent=o,!e.wrapper)switch(e.effect){case"hard":var n={};n[f+"transform-style"]="preserve-3d",n[f+"backface-visibility"]="hidden",e.wrapper=t("<div/>",a(0,0,2)).css(n).appendTo(o).prepend(this),e.fpage=t("<div/>",a(0,0,1)).css(n).appendTo(o),i.opts.gradients&&(e.ashadow=t("<div/>",a(0,0,0)).hide().appendTo(o),e.bshadow=t("<div/>",a(0,0,0)));break;case"sheet":var n=this.width(),s=this.height();Math.round(Math.sqrt(Math.pow(n,2)+Math.pow(s,2))),e.fparent=e.opts.turn.data().fparent,e.fparent||(n=t("<div/>",{css:{"pointer-events":"none"}}).hide(),n.data().flips=0,n.css(a(0,0,"auto","visible").css).appendTo(e.opts.turn),e.opts.turn.data().fparent=n,e.fparent=n),this.css({position:"absolute",top:0,left:0,bottom:"auto",right:"auto"}),e.wrapper=t("<div/>",a(0,0,this.css("z-index"))).appendTo(o).prepend(this),e.fwrapper=t("<div/>",a(o.offset().top,o.offset().left)).hide().appendTo(e.fparent),e.fpage=t("<div/>",a(0,0,0,"visible")).css({cursor:"default"}).appendTo(e.fwrapper),i.opts.gradients&&(e.ashadow=t("<div/>",a(0,0,1)).appendTo(e.fpage)),T.setData.call(this,e)}T.resize.call(this,!0)},_fold:function(t){var e=this.data().f,a=e.opts.turn.data(),i=T._c.call(this,t.corner),r=this.width(),h=this.height();switch(e.effect){case"hard":t.x="l"==t.corner?Math.min(Math.max(t.x,0),2*r):Math.max(Math.min(t.x,r),-r);var p,l,u,g,w,x=a.totalPages,b=e.opts["z-index"]||x,y={overflow:"visible"},z=i.x?(i.x-t.x)/r:t.x/r,P=90*z,_=90>P;switch(t.corner){case"l":g="0% 50%",w="100% 50%",_?(p=0,l=0<e.opts.next-1,u=1):(p="100%",l=e.opts.page+1<x,u=0);break;case"r":g="100% 50%",w="0% 50%",P=-P,r=-r,_?(p=0,l=e.opts.next+1<x,u=0):(p="-100%",l=1!=e.opts.page,u=1)}y[f+"perspective-origin"]=w,e.wrapper.transform("rotateY("+P+"deg)translate3d(0px, 0px, "+(this.attr("depth")||0)+"px)",w),e.fpage.transform("translateX("+r+"px) rotateY("+(180+P)+"deg)",g),e.parent.css(y),_?(z=-z+1,e.wrapper.css({zIndex:b+1}),e.fpage.css({zIndex:b})):(z-=1,e.wrapper.css({zIndex:b}),e.fpage.css({zIndex:b+1})),a.opts.gradients&&(l?e.ashadow.css({display:"",left:p,backgroundColor:"rgba(0,0,0,"+.5*z+")"}).transform("rotateY(0deg)"):e.ashadow.hide(),e.bshadow.css({opacity:-z+1}),_?e.bshadow.parent()[0]!=e.wrapper[0]&&e.bshadow.appendTo(e.wrapper):e.bshadow.parent()[0]!=e.fpage[0]&&e.bshadow.appendTo(e.fpage),d(e.bshadow,o(100*u,0),o(100*(-u+1),0),[[0,"rgba(0,0,0,0.3)"],[1,"rgba(0,0,0,0)"]],2));break;case"sheet":var M,k,O,j,E,C,W,$=this,S=0,A=o(0,0),F=o(0,0),I=o(0,0),D=T._foldingPage.call(this);Math.tan(0);var R=a.opts.acceleration,Z=e.wrapper.height(),q="t"==t.corner.substr(0,1),H="l"==t.corner.substr(1,1),Y=function(){var e=o(0,0),n=o(0,0);e.x=i.x?i.x-t.x:t.x,e.y=c?i.y?i.y-t.y:t.y:0,n.x=H?r-e.x/2:t.x+e.x/2,n.y=e.y/2;var s=m-Math.atan2(e.y,e.x),d=s-Math.atan2(n.y,n.x),d=Math.max(0,Math.sin(d)*Math.sqrt(Math.pow(n.x,2)+Math.pow(n.y,2)));return S=180*(s/v),I=o(d*Math.sin(s),d*Math.cos(s)),s>m&&(I.x+=Math.abs(I.y*e.y/e.x),I.y=0,Math.round(I.x*Math.tan(v-s))<h)?(t.y=Math.sqrt(Math.pow(h,2)+2*n.x*e.x),q&&(t.y=h-t.y),Y()):(s>m&&(e=v-s,n=Z-h/Math.sin(e),A=o(Math.round(n*Math.cos(e)),Math.round(n*Math.sin(e))),H&&(A.x=-A.x),q)&&(A.y=-A.y),M=Math.round(I.y/Math.tan(s)+I.x),e=r-M,n=e*Math.cos(2*s),d=e*Math.sin(2*s),F=o(Math.round(H?e-n:M+n),Math.round(q?d:h-d)),a.opts.gradients&&(E=e*Math.sin(s),e=T._c2.call($,t.corner),e=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))/r,W=Math.sin(m*(e>1?2-e:e)),C=Math.min(e,1),j=E>100?(E-100)/E:0,k=o(100*(E*Math.sin(s)/r),100*(E*Math.cos(s)/h)),T._backGradient.call($)&&(O=o(100*(1.2*E*Math.sin(s)/r),100*(1.2*E*Math.cos(s)/h)),H||(O.x=100-O.x),!q))&&(O.y=100-O.y),I.x=Math.round(I.x),I.y=Math.round(I.y),!0)};switch(p=function(t,i,p,l){var u=["0","auto"],g=(r-Z)*p[0]/100,c=(h-Z)*p[1]/100,i={left:u[i[0]],top:u[i[1]],right:u[i[2]],bottom:u[i[3]]},u={},f=90!=l&&-90!=l?H?-1:1:0,v=p[0]+"% "+p[1]+"%";$.css(i).transform(s(l)+n(t.x+f,t.y,R),v),e.fpage.css(i).transform(s(l)+n(t.x+F.x-A.x-r*p[0]/100,t.y+F.y-A.y-h*p[1]/100,R)+s((180/l-2)*l),v),e.wrapper.transform(n(-t.x+g-f,-t.y+c,R)+s(-l),v),e.fwrapper.transform(n(-t.x+A.x+g,-t.y+A.y+c,R)+s(-l),v),a.opts.gradients&&(p[0]&&(k.x=100-k.x),p[1]&&(k.y=100-k.y),u["box-shadow"]="0 0 20px rgba(0,0,0,"+.5*W+")",D.css(u),d(e.ashadow,o(H?100:0,q?0:100),o(k.x,k.y),[[j,"rgba(0,0,0,0)"],[.8*(1-j)+j,"rgba(0,0,0,"+.2*C+")"],[1,"rgba(255,255,255,"+.2*C+")"]],3,0),T._backGradient.call($)&&d(e.bshadow,o(H?0:100,q?0:100),o(O.x,O.y),[[.6,"rgba(0,0,0,0)"],[.8,"rgba(0,0,0,"+.3*C+")"],[1,"rgba(0,0,0,0)"]],3))},t.corner){case"tl":t.x=Math.max(t.x,1),Y(),p(I,[1,0,0,1],[100,0],S);break;case"tr":t.x=Math.min(t.x,r-1),Y(),p(o(-I.x,I.y),[0,0,0,1],[0,0],-S);break;case"bl":t.x=Math.max(t.x,1),Y(),p(o(I.x,-I.y),[1,1,0,0],[100,100],-S);break;case"br":t.x=Math.min(t.x,r-1),Y(),p(o(-I.x,-I.y),[0,1,1,0],[0,100],S)}}e.point=t},_moveFoldingPage:function(t){var e=this.data().f;if(e){var a=e.opts.turn,i=a.data(),o=i.pagePlace;t?(i=e.opts.next,o[i]!=e.opts.page&&(e.folding&&T._moveFoldingPage.call(this,!1),T._foldingPage.call(this).appendTo(e.fpage),o[i]=e.opts.page,e.folding=i),a.turn("update")):e.folding&&(i.pages[e.folding]?(a=i.pages[e.folding].data().f,i.pageObjs[e.folding].appendTo(a.wrapper)):i.pageWrap[e.folding]&&i.pageObjs[e.folding].appendTo(i.pageWrap[e.folding]),e.folding in o&&(o[e.folding]=e.folding),delete e.folding)}},_showFoldedPage:function(t,e){var a=T._foldingPage.call(this),i=this.data(),o=i.f,n=o.visible;if(a){if(!(n&&o.point&&o.point.corner==t.corner||(a="hover"==o.status||"peel"==o.status||o.opts.turn.data().mouseAction?t.corner:null,n=!1,"prevented"!=p("start",this,[o.opts,a]))))return!1;if(e){var s=this,i=o.point&&o.point.corner==t.corner?o.point:T._c.call(this,t.corner,1);this.animatef({from:[i.x,i.y],to:[t.x,t.y],duration:500,frame:function(e){t.x=Math.round(e[0]),t.y=Math.round(e[1]),T._fold.call(s,t)}})}else T._fold.call(this,t),i.effect&&!i.effect.turning&&this.animatef(!1);if(!n)switch(o.effect){case"hard":o.visible=!0,T._moveFoldingPage.call(this,!0),o.fpage.show(),o.opts.shadows&&o.bshadow.show();break;case"sheet":o.visible=!0,o.fparent.show().data().flips++,T._moveFoldingPage.call(this,!0),o.fwrapper.show(),o.bshadow&&o.bshadow.show()}return!0}return!1},hide:function(){var t=this.data().f,e=t.opts.turn.data(),a=T._foldingPage.call(this);switch(t.effect){case"hard":e.opts.gradients&&(t.bshadowLoc=0,t.bshadow.remove(),t.ashadow.hide()),t.wrapper.transform(""),t.fpage.hide();break;case"sheet":0===--t.fparent.data().flips&&t.fparent.hide(),this.css({left:0,top:0,right:"auto",bottom:"auto"}).transform(""),t.wrapper.transform(""),t.fwrapper.hide(),t.bshadow&&t.bshadow.hide(),a.transform("")}return t.visible=!1,this},hideFoldedPage:function(t){var e=this.data().f;if(e.point){var a=this,n=e.point,s=function(){e.point=null,e.status="",a.flip("hide"),a.trigger("end",[e.opts,!1])};if(t){var r=T._c.call(this,n.corner),t="t"==n.corner.substr(0,1)?Math.min(0,n.y-r.y)/2:Math.max(0,n.y-r.y)/2,h=o(n.x,n.y+t),d=o(r.x,r.y-t);this.animatef({from:0,to:1,frame:function(t){t=i(n,h,d,r,t),n.x=t.x,n.y=t.y,T._fold.call(a,n)},complete:s,duration:800,hiding:!0})}else this.animatef(!1),s()}},turnPage:function(t){var e=this,a=this.data().f,o=a.opts.turn.data(),t={corner:a.corner?a.corner.corner:t||T._cAllowed.call(this)[0]},n=a.point||T._c.call(this,t.corner,a.opts.turn?o.opts.elevation:0),s=T._c2.call(this,t.corner);this.trigger("flip").animatef({from:0,to:1,frame:function(a){a=i(n,n,s,s,a),t.x=a.x,t.y=a.y,T._showFoldedPage.call(e,t)},complete:function(){e.trigger("end",[a.opts,!0])},duration:o.opts.duration,turning:!0}),a.corner=null},moving:function(){return"effect"in this.data()},isTurning:function(){return this.flip("moving")&&this.data().effect.turning},corner:function(){return this.data().f.corner},_eventStart:function(t){var e=this.data().f,a=e.opts.turn;if(!e.corner&&!e.disabled&&!this.flip("isTurning")&&e.opts.page==a.data().pagePlace[e.opts.page]){if(e.corner=T._isIArea.call(this,t),e.corner&&T._foldingPage.call(this))return this.trigger("pressed",[e.point]),T._showFoldedPage.call(this,e.corner),!1;e.corner=null}},_eventMove:function(t){var e=this.data().f;if(!e.disabled)if(t=w?t.originalEvent.touches:[t],e.corner){var a=e.parent.offset();e.corner.x=t[0].pageX-a.left,e.corner.y=t[0].pageY-a.top,T._showFoldedPage.call(this,e.corner)}else e.hover&&!this.data().effect&&this.is(":visible")&&((t=T._isIArea.call(this,t[0]))?("sheet"==e.effect&&2==t.corner.length||"hard"==e.effect)&&(e.status="hover",e=T._c.call(this,t.corner,e.opts.cornerSize/2),t.x=e.x,t.y=e.y,T._showFoldedPage.call(this,t,!0)):"hover"==e.status&&(e.status="",T.hideFoldedPage.call(this,!0)))},_eventEnd:function(){var t=this.data().f,e=t.corner;!t.disabled&&e&&"prevented"!=p("released",this,[t.point||e])&&T.hideFoldedPage.call(this,!0),t.corner=null},disable:function(t){return T.setData.call(this,{disabled:t}),this},hover:function(t){return T.setData.call(this,{hover:t}),this},peel:function(e,a){var i=this.data().f;if(e){if(-1==t.inArray(e,b.all))throw l("Corner "+e+" is not permitted");if(-1!=t.inArray(e,T._cAllowed.call(this))){var o=T._c.call(this,e,i.opts.cornerSize/2);i.status="peel",T._showFoldedPage.call(this,{corner:e,x:o.x,y:o.y},a)}}else i.status="",T.hideFoldedPage.call(this,a);return this}};window.requestAnim=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},t.extend(t.fn,{flip:function(){return e(t(this[0]),T,arguments)},turn:function(){return e(t(this[0]),M,arguments)},transform:function(t,e){var a={};return e&&(a[f+"transform-origin"]=e),a[f+"transform"]=t,this.css(a)},animatef:function(e){var a=this.data();if(a.effect&&a.effect.stop(),e){e.to.length||(e.to=[e.to]),e.from.length||(e.from=[e.from]);for(var i=[],o=e.to.length,n=!0,s=this,r=(new Date).getTime(),h=function(){if(a.effect&&n){for(var t=[],d=Math.min(e.duration,(new Date).getTime()-r),p=0;o>p;p++)t.push(a.effect.easing(1,d,e.from[p],i[p],e.duration));e.frame(1==o?t[0]:t),d==e.duration?(delete a.effect,s.data(a),e.complete&&e.complete()):window.requestAnim(h)}},d=0;o>d;d++)i.push(e.to[d]-e.from[d]);a.effect=t.extend({stop:function(){n=!1},easing:function(t,e,a,i,o){return i*Math.sqrt(1-(e=e/o-1)*e)+a}},e),this.data(a),h()}else delete a.effect}}),t.isTouch=w,t.mouseEvents=x,t.cssPrefix=h,t.cssTransitionEnd=function(){var t,e=document.createElement("fakeelement"),a={transition:"transitionend",OTransition:"oTransitionEnd",MSTransition:"transitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in a)if(void 0!==e.style[t])return a[t]},t.findPos=u}(jQuery),function(t){function e(t,a){return t[0]==a[0]?!1:t.attr("page")?!0:t.parent()[0]?e(t.parent(),a):!1}function a(t){function e(t){this.name="TurnJsError",this.message=t}return e.prototype=Error(),e.prototype.constructor=e,new e(t)}function i(t,e,a){return r&&a?" translate3d("+t+"px,"+e+"px, 0px) ":" translate("+t+"px, "+e+"px) "}function o(t,e){return r&&e?" scale3d("+t+", "+t+", 1) ":" scale("+t+") "}function n(t,e){return{x:t,y:e}}function s(t,e){return function(){return t.apply(e,arguments)}}var r,h={max:2,flipbook:null,easeFunction:"ease-in-out",duration:500,when:{}},d={init:function(e){var i=this,o=this.data(),e=t.extend({},h,e);if(!e.flipbook||!e.flipbook.turn("is"))throw a("options.flipbook is required");if(r="WebKitCSSMatrix"in window||"MozPerspective"in document.body.style,"function"!=typeof e.max){var p=e.max;e.max=function(){return p}}o.zoom={opts:e,axis:n(0,0),scrollPos:n(0,0),eventQueue:[],mouseupEvent:function(){return d._eMouseUp.apply(i,arguments)},eventTouchStart:s(d._eTouchStart,i),eventTouchMove:s(d._eTouchMove,i),eventTouchEnd:s(d._eTouchEnd,i),flipbookEvents:{zooming:s(d._eZoom,i),pressed:s(d._ePressed,i),released:s(d._eReleased,i),start:s(d._eStart,i),turning:s(d._eTurning,i),turned:s(d._eTurned,i),destroying:s(d._eDestroying,i)}};for(var l in e.when)Object.prototype.hasOwnProperty.call(e.when,l)&&this.bind("zoom."+l,e.when[l]);for(l in o.zoom.flipbookEvents)Object.prototype.hasOwnProperty.call(o.zoom.flipbookEvents,l)&&e.flipbook.bind(l,o.zoom.flipbookEvents[l]);this.css({position:"relative",overflow:"hidden"}),t.isTouch?(e.flipbook.bind("touchstart",o.zoom.eventTouchStart).bind("touchmove",o.zoom.eventTouchMove).bind("touchend",o.zoom.eventTouchEnd),this.bind("touchstart",d._tap)):this.mousedown(d._mousedown).click(d._tap)},_tap:function(a){var i=t(this),o=i.data().zoom;!o.draggingCorner&&!o.dragging&&e(t(a.target),i)&&(d._addEvent.call(i,"tap",a),(a=d._eventSeq.call(i))&&i.trigger(a))},_addEvent:function(t,e){var a=this.data().zoom,i=(new Date).getTime();a.eventQueue.push({name:t,timestamp:i,event:e}),10<a.eventQueue.length&&a.eventQueue.splice(0,1)},_eventSeq:function(){var e=this.data().zoom.eventQueue,a=e.length-1;return a>0&&"tap"==e[a].name&&"tap"==e[a-1].name&&e[a].event.pageX==e[a-1].event.pageX&&e[a].event.pageY==e[a-1].event.pageY&&200>e[a].timestamp-e[a-1].timestamp&&50<e[a].timestamp-e[a-1].timestamp?t.extend(e[a].event,{type:"zoom.doubleTap"}):"tap"==e[a].name?t.extend(e[a].event,{type:"zoom.tap"}):void 0},_prepareZoom:function(){var e,a=0,i=this.data().zoom,o=1/this.zoom("value");e=i.opts.flipbook;var s=e.turn("direction"),r=e.data(),h=e.offset(),d=this.offset(),p={height:e.height()},l=e.turn("view");if("double"==e.turn("display")&&e.data().opts.autoCenter?l[0]?l[1]?(p.width=e.width(),e=n(h.left-d.left,h.top-d.top)):(p.width=e.width()/2,a="ltr"==s?0:p.width,e=n("ltr"==s?h.left-d.left:h.left-d.left+p.width,h.top-d.top)):(p.width=e.width()/2,a="ltr"==s?p.width:0,e=n("ltr"==s?h.left-d.left+p.width:h.left-d.left,h.top-d.top)):(p.width=e.width(),e=n(h.left-d.left,h.top-d.top)),i.zoomer||(i.zoomer=t("<div />",{"class":"zoomer",css:{overflow:"hidden",position:"absolute",zIndex:"1000000"}}).mousedown(function(){return!1}).appendTo(this)),i.zoomer.css({top:e.y,left:e.x,width:p.width,height:p.height}),s=l.join(","),s!=i.zoomerView)for(i.zoomerView=s,i.zoomer.find("*").remove(),s=0;s<l.length;s++)if(l[s]){var d=r.pageObjs[l[s]].offset(),u=t(r.pageObjs[l[s]]);u.clone().transform("").css({width:u.width()*o,height:u.height()*o,position:"absolute",display:"",top:(d.top-h.top)*o,left:(d.left-h.left-a)*o}).appendTo(i.zoomer)}return{pos:e,size:p}},value:function(){return this.data().zoom.opts.flipbook.turn("zoom")},zoomIn:function(e){var a=this,s=this.data().zoom,r=s.opts.flipbook,h=s.opts.max();r.offset();var p=this.offset();if(s.zoomIn)return this;r.turn("stop");var l=t.Event("zoom.change");if(this.trigger(l,[h]),l.isDefaultPrevented())return this;var u=d._prepareZoom.call(this),g=u.pos,c=n(u.size.width/2,u.size.height/2),l=t.cssPrefix(),f=t.cssTransitionEnd(),v=r.data().opts.autoCenter;s.scale=h,r.data().noCenter=!0,e="undefined"!=typeof e?"x"in e&&"y"in e?n(e.x-g.x,e.y-g.y):t.isTouch?n(e.originalEvent.touches[0].pageX-g.x-p.left,e.originalEvent.touches[0].pageY-g.y-p.top):n(e.pageX-g.x-p.left,e.pageY-g.y-p.top):n(c.x,c.y),(0>e.x||0>e.y||e.x>u.width||e.y>u.height)&&(e.x=c.x,e.y=c.y);var m=n((e.x-c.x)*h+c.x,(e.y-c.y)*h+c.y),e=n(u.size.width*h>this.width()?e.x-m.x:0,u.size.height*h>this.height()?e.y-m.y:0),m=n(Math.abs(u.size.width*h-this.width()),Math.abs(u.size.height*h-this.height())),u=n(Math.min(0,u.size.width*h-this.width()),Math.min(0,u.size.height*h-this.height())),w=n(c.x*h-c.x-g.x-e.x,c.y*h-c.y-g.y-e.y);w.y>m.y?e.y=w.y-m.y+e.y:w.y<u.y&&(e.y=w.y-u.y+e.y),w.x>m.x?e.x=w.x-m.x+e.x:w.x<u.x&&(e.x=w.x-u.x+e.x),w=n(c.x*h-c.x-g.x-e.x,c.y*h-c.y-g.y-e.y),g={},g[l+"transition"]=l+"transform "+s.opts.easeFunction+" "+s.opts.duration+"ms";var x=function(){a.trigger("zoom.zoomIn"),s.zoomIn=!0,s.flipPosition=n(r.css("left"),r.css("top")),r.turn("zoom",h).css({position:"absolute",margin:"",top:0,left:0});var e=r.offset();s.axis=n(e.left-p.left,e.top-p.top),v&&"double"==r.turn("display")&&("ltr"==r.turn("direction")&&!r.turn("view")[0]||"rtl"==r.turn("direction")&&!r.turn("view")[1])&&(s.axis.x=s.axis.x+r.width()/2),a.zoom("scroll",w),a.bind(t.mouseEvents.down,d._eMouseDown),a.bind(t.mouseEvents.move,d._eMouseMove),t(document).bind(t.mouseEvents.up,s.mouseupEvent),a.bind("mousewheel",d._eMouseWheel),setTimeout(function(){s.zoomer.hide(),s.zoomer.remove(),s.zoomer=null,s.zoomerView=null},50)};return s.zoomer.css(g).show(),f?s.zoomer.bind(f,function(){t(this).unbind(f),x()}):setTimeout(x,s.opts.duration),s.zoomer.transform(i(e.x,e.y,!0)+o(h,!0)),this},zoomOut:function(e){var a,s=this,r=this.data().zoom,h=r.opts.flipbook,p=1/r.scale,l=t.cssPrefix(),u=t.cssTransitionEnd();if(a=this.offset(),e="undefined"!=typeof e?e:r.opts.duration,r.zoomIn){var g=t.Event("zoom.change");if(this.trigger(g,[1]),g.isDefaultPrevented())return this;r.zoomIn=!1,r.scale=1,h.data().noCenter=!1,s.unbind(t.mouseEvents.down,d._eMouseDown),s.unbind(t.mouseEvents.move,d._eMouseMove),t(document).unbind(t.mouseEvents.up,r.mouseupEvent),s.unbind("mousewheel",d._eMouseWheel),g={},g[l+"transition"]=l+"transform "+r.opts.easeFunction+" "+e+"ms",h.css(g);var c=t("<div />",{css:{position:"relative",top:r.flipPosition.y,left:r.flipPosition.x,width:h.width()*p,height:h.height()*p,background:"blue"}}).appendTo(h.parent()),g=n(c.offset().left-a.left,c.offset().top-a.top);c.remove();var f=h.data().opts.autoCenter;f&&"double"==h.turn("display")&&(h.turn("view")[0]?h.turn("view")[1]||(g.x="ltr"==h.turn("direction")?g.x+c.width()/4:g.x-c.width()/4):g.x="ltr"==h.turn("direction")?g.x-c.width()/4:g.x+c.width()/4);var v=t.findPos(h[0]);a=n(-h.width()/2-v.left+c.width()/2+g.x+a.left,-h.height()/2-v.top+c.height()/2+g.y+a.top);var m=function(){h[0].style.removeProperty?(h[0].style.removeProperty(l+"transition"),h.transform(h.turn("options").acceleration?i(0,0,!0):"").turn("zoom",1),h[0].style.removeProperty("margin"),h.css({position:"relative",top:r.flipPosition.y,left:r.flipPosition.x})):h.transform("none").turn("zoom",1).css({margin:"",top:r.flipPosition.y,left:r.flipPosition.x,position:"relative"}),f&&h.turn("center"),s.trigger("zoom.zoomOut")};return 0===e?m():(u?h.bind(u,function(){t(this).unbind(u),m()}):setTimeout(m,e),h.transform(i(a.x,a.y,!0)+o(p,!0))),this}},flipbookWidth:function(){var t=this.data().zoom.opts.flipbook,e=t.turn("view");return"double"!=t.turn("display")||e[0]&&e[1]?t.width():t.width()/2},scroll:function(e,a,o){var s=this.data().zoom,h=s.opts.flipbook,d=this.zoom("flipbookWidth"),p=t.cssPrefix();if(r){var l={};l[p+"transition"]=o?p+"transform 200ms":"none",h.css(l),h.transform(i(-s.axis.x-e.x,-s.axis.y-e.y,!0))}else h.css({top:-s.axis.y-e.y,left:-s.axis.x-e.x});if(!a){var u,a=n(Math.min(0,(d-this.width())/2),Math.min(0,(h.height()-this.height())/2)),h=n(d>this.width()?d-this.width():(d-this.width())/2,h.height()>this.height()?h.height()-this.height():(h.height()-this.height())/2);e.y<a.y?(e.y=a.y,u=!0):e.y>h.y&&(e.y=h.y,u=!0),e.x<a.x?(e.x=a.x,u=!0):e.x>h.x&&(e.x=h.x,u=!0),u&&this.zoom("scroll",e,!0,!0)}s.scrollPos=n(e.x,e.y)},resize:function(){var t=this.data().zoom,e=t.opts.flipbook;if(1<this.zoom("value")){var a=e.offset(),i=this.offset();t.axis=n(a.left-i.left+(t.axis.x+t.scrollPos.x),a.top-i.top+(t.axis.y+t.scrollPos.y)),"double"==e.turn("display")&&"ltr"==e.turn("direction")&&!e.turn("view")[0]&&(t.axis.x+=e.width()/2),this.zoom("scroll",t.scrollPos)}},_eZoom:function(){for(var t=this.data().zoom,e=t.opts.flipbook,a=e.turn("view"),i=0;i<a.length;i++)a[i]&&this.trigger("zoom.resize",[t.scale,a[i],e.data().pageObjs[a[i]]])},_eStart:function(t){1!=this.zoom("value")&&t.preventDefault()},_eTurning:function(t,e,a){var i=this,t=this.zoom("value"),o=this.data().zoom,e=o.opts.flipbook;if(o.page=e.turn("page"),1!=t){for(o=0;o<a.length;o++)a[o]&&this.trigger("zoom.resize",[t,a[o],e.data().pageObjs[a[o]]]);setTimeout(function(){i.zoom("resize")},0)}},_eTurned:function(t,e){if(1!=this.zoom("value")){var a=this.data().zoom,i=a.opts.flipbook;e>a.page?this.zoom("scroll",n(0,a.scrollPos.y),!1,!0):e<a.page&&this.zoom("scroll",n(i.width(),a.scrollPos.y),!1,!0)}},_ePressed:function(){t(this).data().zoom.draggingCorner=!0},_eReleased:function(){var e=t(this).data().zoom;setTimeout(function(){e.draggingCorner=!1},1)},_eMouseDown:function(e){return t(this).data().zoom.draggingCur=t.isTouch?n(e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY):n(e.pageX,e.pageY),!1},_eMouseMove:function(e){var a=t(this).data().zoom;if(a.draggingCur){a.dragging=!0;var e=t.isTouch?n(e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY):n(e.pageX,e.pageY),i=n(e.x-a.draggingCur.x,e.y-a.draggingCur.y);return t(this).zoom("scroll",n(a.scrollPos.x-i.x,a.scrollPos.y-i.y),!0),a.draggingCur=e,!1}},_eMouseUp:function(){var e=t(this).data().zoom;e.dragging&&t(this).zoom("scroll",e.scrollPos),e.draggingCur=null,setTimeout(function(){e.dragging=!1},1)},_eMouseWheel:function(e,a,i,o){e=t(this).data().zoom,i=n(e.scrollPos.x+10*i,e.scrollPos.y-10*o),t(this).zoom("scroll",i,!1,!0)},_eTouchStart:function(e){var a=t(this).data().zoom,e=n(e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY);a.touch={},a.touch.initial=e,a.touch.last=e,a.touch.timestamp=(new Date).getTime(),a.touch.speed=n(0,0)},_eTouchMove:function(e){var a=t(this).data().zoom,i=t(this).zoom("value"),o=a.opts.flipbook,s=(new Date).getTime(),e=n(e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY);a.touch&&1==i&&!o.data().mouseAction&&(a.touch.motion=n(e.x-a.touch.last.x,e.y-a.touch.last.y),a.touch.speed.x=0===a.touch.speed.x?a.touch.motion.x/(s-a.touch.timestamp):(a.touch.speed.x+a.touch.motion.x/(s-a.touch.timestamp))/2,a.touch.last=e,a.touch.timestamp=s)},_eTouchEnd:function(){var e=t(this).data().zoom;if(e.touch&&1==t(this).zoom("value")){var a=Math.abs(e.touch.initial.y-e.touch.last.y);50>a&&(-1>e.touch.speed.x||-100>e.touch.last.x-e.touch.initial.x)?this.trigger("zoom.swipeLeft"):50>a&&(1<e.touch.speed.x||100<e.touch.last.x-e.touch.initial.x)&&this.trigger("zoom.swipeRight")}},_eDestroying:function(){var e=this,a=this.data().zoom,i=a.opts.flipbook;this.zoom("zoomOut",0),t.each("tap doubleTap resize zoomIn zoomOut swipeLeft swipeRight".split(" "),function(t,a){e.unbind("zoom."+a)});for(var o in a.flipbookEvents)Object.prototype.hasOwnProperty.call(a.flipbookEvents,o)&&i.unbind(o,a.flipbookEvents[o]);i.unbind("touchstart",a.eventTouchStart).unbind("touchmove",a.eventTouchMove).unbind("touchend",a.eventTouchEnd),this.unbind("touchstart",d._tap).unbind("click",d._tap),a=null,this.data().zoom=null}};t.extend(t.fn,{zoom:function(){var e=arguments;if(!e[0]||"object"==typeof e[0])return d.init.apply(t(this[0]),e);if(d[e[0]])return d[e[0]].apply(t(this[0]),Array.prototype.slice.call(e,1));throw a(e[0]+" is not a method")}})}(jQuery);function addPage(page,book,edition){var id,pages=book.turn('pages');var element=$('<div />',{});if(book.turn('addPage',element,page)){element.html('<div class="gradient"></div><div class="loader"></div>');loadPage(page,element,edition);}}
function loadPage(page,pageElement,edition){var img=$('<img />');img.mousedown(function(e){e.preventDefault();});img.load(function(){$(this).css({width:'100%',height:'100%'});$(this).appendTo(pageElement);pageElement.find('.loader').remove();});img.attr('src',edition+'/'+page+'.jpg');loadRegions(page,pageElement,edition);}
function loadRegions(page,element,edition){$.getJSON(edition+'/'+page+'-regions.json').done(function(data){$.each(data,function(key,region){addRegion(region,element);});});}
function addRegion(region,pageElement){var reg=$('<div />',{'class':'region  '+region['class']}),options=$('.magazine').turn('options'),pageWidth=options.width/2,pageHeight=options.height;reg.css({top:Math.round(region.y/pageHeight*100)+'%',left:Math.round(region.x/pageWidth*100)+'%',width:Math.round(region.width/pageWidth*100)+'%',height:Math.round(region.height/pageHeight*100)+'%'}).attr('region-data',$.param(region.data||''));reg.appendTo(pageElement);}
function regionClick(event){var region=$(event.target);if(region.hasClass('region')){var regionType=$.trim(region.attr('class').replace('region',''));return processRegion(region,regionType);}}
function processRegion(region,regionType){data=decodeParams(region.attr('region-data'));switch(regionType){case'link':window.open(data.url);break;case'zoom':var regionOffset=region.offset(),viewportOffset=$('.magazine-viewport').offset(),pos={x:regionOffset.left-viewportOffset.left,y:regionOffset.top-viewportOffset.top};$('.magazine-viewport').zoom('zoomIn',pos);break;case'to-page':$('.magazine').turn('page',data.page);break;}}
function loadLargePage(page,pageElement,edition){var img=$('<img />');img.load(function(){var prevImg=pageElement.find('img');$(this).css({width:'100%',height:'100%'});$(this).appendTo(pageElement);prevImg.remove();});img.attr('src',edition+'/'+page+'-large.jpg');}
function loadSmallPage(page,pageElement,edition){var img=pageElement.find('img');img.css({width:'100%',height:'100%'});img.unbind('load');img.attr('src',edition+'/'+page+'.jpg');}
function isChrome(){return navigator.userAgent.indexOf('Chrome')!=-1;}
function disableControls(page){if(page==1)
$('.previous-button').hide();else
$('.previous-button').show();if(page==$('.magazine').turn('pages'))
$('.next-button').hide();else
$('.next-button').show();}
function resizeViewport(){var width=$(window).width(),height=$(window).height(),options=$('.magazine').turn('options');$('.magazine').removeClass('animated');$('.magazine-viewport').css({width:width,height:height}).zoom('resize');if($('.magazine').turn('zoom')==1){var bound=calculateBound({width:options.width,height:options.height,boundWidth:Math.min(options.width,width),boundHeight:Math.min(options.height,height)});if(bound.width%2!==0)
bound.width-=1;if(bound.width!=$('.magazine').width()||bound.height!=$('.magazine').height()){$('.magazine').turn('size',bound.width,bound.height);if($('.magazine').turn('page')==1)
$('.magazine').turn('peel','br');$('.next-button').css({height:bound.height,backgroundPosition:'-38px '+(bound.height/2-32/2)+'px'});$('.previous-button').css({height:bound.height,backgroundPosition:'-4px '+(bound.height/2-32/2)+'px'});}
$('.magazine').css({top:-bound.height/2,left:-bound.width/2});}
var magazineOffset=$('.magazine').offset(),boundH=height-magazineOffset.top-$('.magazine').height(),marginTop=(boundH-$('.thumbnails > div').height())/ 2;if(marginTop<0){$('.thumbnails').css({height:1});}else{$('.thumbnails').css({height:boundH});$('.thumbnails > div').css({marginTop:marginTop});}
if(magazineOffset.top<$('.made').height())
$('.made').hide();else
$('.made').show();$('.magazine').addClass('animated');}
function largeMagazineWidth(){return 2214;}
function decodeParams(data){var parts=data.split('&'),d,obj={};for(var i=0;i<parts.length;i++){d=parts[i].split('=');obj[decodeURIComponent(d[0])]=decodeURIComponent(d[1]);}
return obj;}
function calculateBound(d){var bound={width:d.width,height:d.height};if(bound.width>d.boundWidth||bound.height>d.boundHeight){var rel=bound.width/bound.height;if(d.boundWidth/rel>d.boundHeight&&d.boundHeight*rel<=d.boundWidth){bound.width=Math.round(d.boundHeight*rel);bound.height=d.boundHeight;}else{bound.width=d.boundWidth;bound.height=Math.round(d.boundWidth/rel);}}
return bound;}